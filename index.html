<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blinky Mate</title>

  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- iOS PWA setup -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Blinky Mate" />

  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/blinky-mate-icon.png" />

  <style>
    :root {
      --white: #f5f5f5;
    }

    body { 
      margin: 0; 
      min-height: 100vh; 
      color: var(--white);
    }

    .bg-white {
      background-color: var(--white);
    }
  </style>
</head>

<body class="bg-[#212124] min-h-screen flex flex-col justify-between">
  <!-- Main Content -->
  <div class="flex-1 py-2 px-6">
    <section class="flex flex-row justify-between items-center">
      <article>
        <h3 class="text-2xl">Hello,</h3>
        <h1 class="font-semibold text-3xl">Jana Venice</h1>
      </article>
      <img src="/assets/images/avatar.png" alt="Profile" class="w-14 h-14 rounded-full object-cover">
    </section>

    <!-- Expense Overview -->
    <section class="flex justify-between mt-6">
      <article class="flex items-start gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-14">
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0 1 15.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 0 1 3 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 0 0-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 0 1-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 0 0 3 15h-.75M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm3 0h.008v.008H18V10.5Zm-12 0h.008v.008H6V10.5Z" />
        </svg>
        <article class="flex flex-col">
          <span class="text-md">Today</span>
          <span class="text-2xl font-semibold">$12.23</span>
        </article>
      </article>

      <article class="flex items-start gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-14">
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0 1 15.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 0 1 3 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 0 0-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 0 1-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 0 0 3 15h-.75M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm3 0h.008v.008H18V10.5Zm-12 0h.008v.008H6V10.5Z" />
        </svg>
        <article class="flex flex-col">
          <span class="text-md">This Month</span>
          <span class="text-2xl font-semibold">$8,749.78</span>
        </article>
      </article>
    </section>

    <!-- Cards -->
    <h1 class="mt-6 text-3xl mb-4 font-semibold">Cards</h1>
    <div class="w-full max-w-md overflow-x-auto scroll-smooth snap-x snap-mandatory flex space-x-4">
      <!-- Card 1 -->
       <div class="snap-start min-w-[300px] h-auto bg-[#9DA39A] rounded-xl p-6 text-white shadow-lg flex flex-col flex-shrink-0">
        <article class="flex justify-between items-center">
          <img src="/assets/images/mc.png" alt="MC Logo" class="h-6">
          <img src="/assets/images/contactless.png" alt="Chip" class="h-6">
        </article>
        <span class="mt-6 text-2xl">**** **** **** 5129</span>
        <section class="flex gap-16 items-center mt-6">
          <article class="flex flex-col">
            <span class="text-xs">Card Holder</span>
            <span>Jana Dayao</span>
          </article>
          <article class="flex flex-col">
            <span class="text-xs">Exp Date</span>
            <span>12/27</span>
          </article>
        </section>
      </div>

      <!-- Card 2 -->
      <div class="snap-start min-w-[300px] h-auto bg-[#CDACA1] rounded-xl p-6 text-white shadow-lg flex flex-col flex-shrink-0">
        <article class="flex justify-between items-center">
          <img src="/assets/images/visa.png" alt="Visa Logo" class="h-4">
          <img src="/assets/images/contactless.png" alt="Chip" class="h-6">
        </article>
        <span class="mt-6 text-2xl">**** **** **** 0422</span>
        <section class="flex gap-16 items-center mt-6">
          <article class="flex flex-col">
            <span class="text-xs">Card Holder</span>
            <span>Jana Dayao</span>
          </article>
          <article class="flex flex-col">
            <span class="text-xs">Exp Date</span>
            <span>09/32</span>
          </article>
        </section>
      </div>

      <!-- Card 3 -->
      <div class="snap-start min-w-[300px] h-auto bg-[#C9DCB3] rounded-xl p-6 text-white shadow-lg flex flex-col flex-shrink-0">
        <article class="flex justify-between items-center">
          <img src="/assets/images/visa.png" alt="Visa Logo" class="h-4">
          <img src="/assets/images/contactless.png" alt="Chip" class="h-6">
        </article>
        <span class="mt-6 text-2xl">**** **** **** 2176</span>
        <section class="flex gap-16 items-center mt-6">
          <article class="flex flex-col">
            <span class="text-xs">Card Holder</span>
            <span>Jana Venice</span>
          </article>
          <article class="flex flex-col">
            <span class="text-xs">Exp Date</span>
            <span>06/28</span>
          </article>
        </section>
      </div>
    </div>

    <!-- Recurring Payments -->
    <h1 class="mt-6 text-3xl mb-4 font-semibold">Subscriptions</h1>
    <div id="recurring-container" class="w-full max-w-md overflow-x-auto scroll-smooth snap-x snap-mandatory flex space-x-4">
      <!-- Cards here -->
    </div>

    <!-- Recent Transactions -->
    <article class="flex justify-between items-end mt-6 mb-4">
      <h1 class="text-3xl font-semibold">Recent Transactions</h1>
      <a href="#">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-8">
          <path stroke-linecap="round" stroke-linejoin="round" d="m12.75 15 3-3m0 0-3-3m3 3h-7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
        </svg>
      </a>
    </article>
    <section id="expenses-container" class="w-full max-w-md flex flex-col gap-2 mb-20">
      <!-- Expense cardds here -->
    </section>

  </div>

  <!-- Drawer (fixed to bottom) -->
  <div id="drawer" class="fixed bottom-0 left-0 right-0 h-[600px] bg-gray-700 rounded-t-xl shadow-xl transform translate-y-full transition-transform duration-300 z-50 touch-none">
    
    <!-- Drag Handle -->
    <div id="dragHandle" class="w-24 h-1.5 bg-gray-400 rounded-full mx-auto mt-2 mb-4"></div>
    
    <!-- Toggle Radio Buttons -->
    <div class="flex mt-2 w-full px-6">
      <label class="flex-1 cursor-pointer">
        <input type="radio" name="type" value="income" class="peer hidden" checked>
        <span class="block text-center px-6 py-2 rounded-l-full border border-white bg-[#212124] text-white font-medium peer-checked:bg-white peer-checked:text-black peer-checked:border-white transition">
          Income
        </span>
      </label>
      <label class="flex-1 cursor-pointer">
        <input type="radio" name="type" value="expense" class="peer hidden">
        <span class="block text-center px-6 py-2 rounded-r-full border border-white bg-[#212124] text-white font-medium peer-checked:bg-white peer-checked:text-black peer-checked:border-white transition">
          Expense
        </span>
      </label>
    </div>

    <!-- Form Content -->
    <div id="formContent" class="py-4 px-6 text-black">
      
      <!-- INCOME FORM -->
      <form id="incomeForm" class="hidden w-full flex flex-col gap-4">
        <section class="flex flex-row justify-between gap-3 items-end">
          <article class="text-white flex flex-col mb-2 w-full">
            <label class="text-lg">Source</label>
            <select class="w-full rounded-3xl border border-gray-300 bg-white py-3 px-4 text-gray-700 text-base font-medium shadow-sm focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-green-400 transition">
              <option>Salary</option>
              <option>Allowance</option>
              <option>Business</option>
              <option>Investment</option>
              <option>Freelance</option>
              <option>Other</option>
            </select>
          </article>
          <article class="flex flex-col mb-2">
            <div class="relative">
              <input type="date" class="absolute inset-0 opacity-0 cursor-pointer" />
              <button type="button">
                <!-- Calendar Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#ffffff" class="w-8 h-8">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
              </button>
            </div>
          </article>
        </section>

        <!-- Amount Input -->
        <article class="flex flex-row justify-center items-center w-full">
          <span class="text-white text-5xl mr-2">$</span>
          <input 
            id="incomeAmount"
            type="text"
            placeholder="0.00"
            inputmode="decimal"
            class="border-none bg-transparent text-white text-5xl focus:outline-none w-[4ch]"
          />
        </article>      

        <!-- Submit button -->
        <button type="submit" class="mt-4 bg-white text-black text-xl py-2 px-4 rounded-3xl">Add Income</button>
      </form>


      <!-- EXPENSE FORM -->
      <form id="expenseForm" class="w-full flex flex-col gap-2">
        <!-- Name & Date -->
        <section class="flex flex-row justify-between gap-3 items-end">
          <article class="text-white flex flex-col mb-2 w-full">
            <label class="text-lg">Name</label>
            <input 
              type="text" 
              placeholder="Expense Name" 
              class="w-full rounded-3xl border border-gray-300 bg-white py-3 px-4 text-gray-700 text-base font-medium shadow-sm focus:outline-none focus:ring-2 focus:ring-red-400 focus:border-red-400 transition"
            />
          </article>
          <article class="flex flex-col mb-2">
            <div class="relative">
              <input type="date" class="absolute inset-0 opacity-0 cursor-pointer" />
              <button type="button">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#ffffff" class="w-8 h-8">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
              </button>
            </div>
          </article>
        </section>

        <!-- Category & Payment -->
        <article class="flex flex-row gap-4">
          <article class="text-white flex flex-col mb-2 w-1/2">
            <label class=" text-lg">Category</label>
            <select class="w-full rounded-3xl border border-gray-300 bg-white py-3 px-4 text-gray-700 text-base font-medium shadow-sm focus:outline-none focus:ring-2 focus:ring-red-400 focus:border-red-400 transition">
              <option>Private Transport</option>
              <option>Public Transport</option>
              <option>Office Food</option>
              <option>Dine-out</option>
              <option>Drinks</option>
              <option>Grocery</option>
              <option>Rental Bike</option>
              <option>Bills</option>
              <option>Shopping</option>
              <option>Travel</option>
              <option>Others</option>
            </select>
          </article>
          <article class="text-white flex flex-col mb-2 w-1/2">
            <label class="text-lg">Payment</label>
            <select class="w-full rounded-3xl border border-gray-300 bg-white py-3 px-4 text-gray-700 text-base font-medium shadow-sm focus:outline-none focus:ring-2 focus:ring-red-400 focus:border-red-400 transition">
              <option>Credit Card</option>
              <option>Debit Card</option>
              <option>Cash</option>
            </select>
          </article>
        </article>

        <!-- Amount Input -->
        <article class="flex flex-row justify-center items-center w-full">
          <span class="text-white text-5xl mr-2">$</span>
          <input 
            id="expenseAmount"
            type="text"
            placeholder="0.00"
            inputmode="decimal"
            class="border-none bg-transparent text-white text-5xl focus:outline-none w-[4ch]"
          />
        </article>

        <!-- Submit button -->
        <button type="submit" class="mt-4 bg-white text-black text-xl py-2 px-4 rounded-3xl">Add Expense</button>
      </form>

    </div>
  </div>

  <!-- Bottom Navbar -->
  <div class="relative">
    <div class="fixed bottom-0 left-0 right-0 bg-[#E0DDCF] shadow-lg flex justify-between items-center px-10 py-2">
      
      <!-- Home Icon -->
      <a href="#" class="flex flex-col items-center text-gray-700 ml-7">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-8">
          <path d="M11.47 3.841a.75.75 0 0 1 1.06 0l8.69 8.69a.75.75 0 1 0 1.06-1.061l-8.689-8.69a2.25 2.25 0 0 0-3.182 0l-8.69 8.69a.75.75 0 1 0 1.061 1.06l8.69-8.689Z" />
          <path d="m12 5.432 8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 0 1-.75-.75v-4.5a.75.75 0 0 0-.75-.75h-3a.75.75 0 0 0-.75.75V21a.75.75 0 0 1-.75.75H5.625a1.875 1.875 0 0 1-1.875-1.875v-6.198a2.29 2.29 0 0 0 .091-.086L12 5.432Z" />
        </svg>
        <span class="text-sm">Home</span>
      </a>

      <!-- Stats Icon -->
      <a href="#" class="flex flex-col items-center text-gray-700 mr-4">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-8">
          <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0 0 20.25 18V6A2.25 2.25 0 0 0 18 3.75H6A2.25 2.25 0 0 0 3.75 6v12A2.25 2.25 0 0 0 6 20.25Z" />
        </svg>
        <span class="text-sm">Statistics</span>
      </a>
    </div>

    <!-- Floating Action Button (FAB) -->
    <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2">
      <button id="fabButton" class="bg-gray-700 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" 
            viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
        </svg>
      </button>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'recurringPayments';
    const EXPENSES_KEY = 'expensesHistory';

    const container = document.getElementById('recurring-container');
    const expensesContainer = document.getElementById('expenses-container');

    const drawer = document.getElementById('drawer');
    const fabButton = document.getElementById('fabButton');
    const dragHandle = document.getElementById('dragHandle');

    const incomeRadio = document.querySelector('input[value="income"]');
    const expenseRadio = document.querySelector('input[value="expense"]');
    const incomeForm = document.getElementById('incomeForm');
    const expenseForm = document.getElementById('expenseForm');

    function saveToLocalStorage(type, data) {
      let existing = JSON.parse(localStorage.getItem(type)) || [];
      existing.push(data);
      localStorage.setItem(type, JSON.stringify(existing));
      alert(`✅ ${type.slice(0,1).toUpperCase() + type.slice(1)} added successfully!`);
    }

    // 🔹 Income form handler
    document.getElementById("incomeForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const source = this.querySelector("select").value;
      const date = this.querySelector('input[type="date"]').value;
      const amount = parseFloat(document.getElementById("incomeAmount").value) || 0;

      const incomeData = {
        source,
        amount,
        currency: "SGD",
        date: date ? new Date(date).toISOString() : new Date().toISOString()
      };

      saveToLocalStorage("incomes", incomeData);
      this.reset();
      document.getElementById("incomeAmount").style.width = "4ch"; // reset width
    });

    // 🔹 Helper to save expense to localStorage
    function saveExpense(expenseData) {
      let existing = JSON.parse(localStorage.getItem(EXPENSES_KEY)) || [];
      existing.push(expenseData);
      localStorage.setItem(EXPENSES_KEY, JSON.stringify(existing));
      renderExpenses(); // refresh the list after adding
      alert('✅ Expense added successfully!');
    }

    // 🔹 Expense form handler
    document.getElementById("expenseForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const name = this.querySelector('input[type="text"]').value;
      const date = this.querySelector('input[type="date"]').value;
      const category = this.querySelectorAll("select")[0].value;
      const payment = this.querySelectorAll("select")[1].value;
      const amount = parseFloat(document.getElementById("expenseAmount").value) || 0;

      const expenseData = {
        name,
        category,
        amount,
        currency: "SGD",
        paymentMethod: payment,
        date: date ? new Date(date).toISOString() : new Date().toISOString()
      };

      saveExpense(expenseData);

      this.reset();
      document.getElementById("expenseAmount").style.width = "4ch"; // reset width
    });

    function resizeInput(input) {
      const length = input.value.length > 0 ? input.value.length : input.placeholder.length;
      input.style.width = `${length}ch`;
    }

    // Select both income & expense inputs
    const inputs = [document.getElementById("incomeAmount"), document.getElementById("expenseAmount")];

    // Add event listener to each
    inputs.forEach(input => {
      if (input) {
        input.addEventListener("input", () => resizeInput(input));
        resizeInput(input); // run once on load
      }
    });

    let startY = 0;
    let currentY = 0;
    let isDragging = false;

    function updateForm() {
      if (incomeRadio.checked) {
        incomeForm.classList.remove('hidden');
        expenseForm.classList.add('hidden');
      } else if (expenseRadio.checked) {
        expenseForm.classList.remove('hidden');
        incomeForm.classList.add('hidden');
      }
    }

    // attach events
    incomeRadio.addEventListener('change', updateForm);
    expenseRadio.addEventListener('change', updateForm);

    // run once on load so the correct form shows immediately
    updateForm();
    
    incomeRadio.addEventListener('change', () => {
      if (incomeRadio.checked) {
        incomeForm.classList.remove('hidden');
        expenseForm.classList.add('hidden');
      }
    });

    expenseRadio.addEventListener('change', () => {
      if (expenseRadio.checked) {
        expenseForm.classList.remove('hidden');
        incomeForm.classList.add('hidden');
      }
    });

    // Open drawer when FAB clicked
    fabButton.addEventListener('click', () => {
      drawer.style.transform = 'translateY(0)';
    });

    // Touch events for dragging
    dragHandle.addEventListener('touchstart', (e) => {
      isDragging = true;
      startY = e.touches[0].clientY;
      drawer.style.transition = 'none'; // disable animation while dragging
    });

    dragHandle.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      currentY = e.touches[0].clientY;
      const deltaY = currentY - startY;
      if (deltaY > 0) { // only drag down
        drawer.style.transform = `translateY(${deltaY}px)`;
      }
    });

    dragHandle.addEventListener('touchend', (e) => {
      isDragging = false;
      drawer.style.transition = 'transform 0.3s ease';

      const deltaY = currentY - startY;
      if (deltaY > 150) { // if dragged enough, close it
        drawer.style.transform = 'translateY(100%)';
      } else { // else snap back
        drawer.style.transform = 'translateY(0)';
      }
    });

    // Close drawer when clicking outside
    document.addEventListener('click', (e) => {
      const isClickInsideDrawer = drawer.contains(e.target);
      const isClickOnFAB = fabButton.contains(e.target);

      if (!isClickInsideDrawer && !isClickOnFAB) {
        drawer.style.transform = 'translateY(100%)';
      }
    });

    // Function to render cards from localStorage
    function renderCards() {
      const payments = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
      container.innerHTML = ''; // Clear container

      payments.forEach(payment => {
        const now = new Date();
        const billingDate = new Date(payment.nextBillingDate);
        const diffTime = billingDate - now;
        const daysLeft = Math.max(Math.ceil(diffTime / (1000 * 60 * 60 * 24)), 0);

        const card = document.createElement('div');
        card.className = 'snap-start min-w-[200px] h-auto bg-[#E0DDCF] rounded-xl p-6 text-white shadow-lg flex flex-col flex-shrink-0';
        card.innerHTML = `
          <article class="rounded-full bg-white py-2 w-12 h-12 flex items-center justify-center">
            <img src="${payment.image}" alt="${payment.name} Logo" class="h-10">
          </article>
          <span class="mt-4 text-2xl text-black font-semibold">${payment.name}</span>
          <span class="text-lg text-black">$${payment.price.toFixed(2)}/${payment.interval}</span>
          <span class="text-base text-gray-400">${daysLeft} day${daysLeft !== 1 ? 's' : ''} left</span>
        `;
        container.appendChild(card);
      });
    }

    // Category → Icon mapping
    const categoryIcons = {
      "Office Food": `
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 1024 768">
          <path fill="#ffffff" d="M992 640H32q-13 0-22.5-9.5T0 608q0-188 116.5-320.5T416 128q13 0 22.5-9.5T448 96t-9.5-22.5T416 64t-22.5-9.5T384 32t9.5-22.5T416 0h192q13 0 22.5 9.5T640 32t-9.5 22.5T608 64t-22.5 9.5T576 96t9.5 22.5T608 128q183 27 299.5 159.5T1024 608q0 13-9.5 22.5T992 640zM32 704h960q13 0 22.5 9.5t9.5 22.5t-9.5 22.5T992 768H32q-13 0-22.5-9.5T0 736t9.5-22.5T32 704z"/>
          </svg>
      `,
      "Dine-out": `
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24">
            <g fill="#ffffff">
                <path fill="#ffffff" d="M19 18h.75H19ZM5 14.584h.75a.75.75 0 0 0-.45-.687l-.3.687Zm14 0l-.3-.687a.75.75 0 0 0-.45.687H19ZM15.75 7a.75.75 0 0 0 1.5 0h-1.5Zm-9 0a.75.75 0 0 0 1.5 0h-1.5ZM7 4.25A5.75 5.75 0 0 0 1.25 10h1.5A4.25 4.25 0 0 1 7 5.75v-1.5Zm10 1.5A4.25 4.25 0 0 1 21.25 10h1.5A5.75 5.75 0 0 0 17 4.25v1.5Zm-2 15.5H9v1.5h6v-1.5Zm-6 0c-.964 0-1.612-.002-2.095-.067c-.461-.062-.659-.169-.789-.3l-1.06 1.062c.455.455 1.022.64 1.65.725c.606.082 1.372.08 2.294.08v-1.5ZM4.25 18c0 .922-.002 1.688.08 2.294c.084.628.27 1.195.725 1.65l1.061-1.06c-.13-.13-.237-.328-.3-.79c-.064-.482-.066-1.13-.066-2.094h-1.5Zm14 0c0 .964-.002 1.612-.067 2.095c-.062.461-.169.659-.3.789l1.062 1.06c.455-.455.64-1.022.725-1.65c.082-.606.08-1.372.08-2.294h-1.5ZM15 22.75c.922 0 1.688.002 2.294-.08c.628-.084 1.195-.27 1.65-.726l-1.06-1.06c-.13.13-.328.237-.79.3c-.482.064-1.13.066-2.094.066v1.5Zm-8-17c.214 0 .423.016.628.046l.219-1.484A5.792 5.792 0 0 0 7 4.25v1.5Zm5-4.5a5.252 5.252 0 0 0-4.973 3.563l1.42.482A3.752 3.752 0 0 1 12 2.75v-1.5ZM7.027 4.813A5.245 5.245 0 0 0 6.75 6.5h1.5c0-.423.07-.828.198-1.205l-1.42-.482ZM17 4.25c-.287 0-.57.021-.847.062l.22 1.484A4.29 4.29 0 0 1 17 5.75v-1.5Zm-5-1.5a3.752 3.752 0 0 1 3.552 2.545l1.42-.482A5.252 5.252 0 0 0 12 1.25v1.5Zm3.552 2.545c.128.377.198.782.198 1.205h1.5c0-.589-.097-1.156-.277-1.687l-1.42.482ZM5.75 18v-3.416h-1.5V18h1.5Zm-.45-4.103A4.251 4.251 0 0 1 2.75 10h-1.5a5.751 5.751 0 0 0 3.45 5.271l.6-1.374Zm12.95.687V18h1.5v-3.416h-1.5Zm3-4.584a4.251 4.251 0 0 1-2.55 3.897l.6 1.374A5.751 5.751 0 0 0 22.75 10h-1.5Zm-5.5-3.5V7h1.5v-.5h-1.5Zm-9 0V7h1.5v-.5h-1.5Zm4.293 7.169l-.444.605l.444-.605ZM12 9.995l-.519.542a.75.75 0 0 0 1.038 0L12 9.995Zm.957 3.674l-.444-.605l.444.605Zm-.957.462v-.75v.75Zm-.514-1.067c-.417-.306-.878-.69-1.227-1.092c-.368-.426-.509-.757-.509-.972h-1.5c0 .77.441 1.451.875 1.953c.453.524 1.014.983 1.474 1.32l.887-1.209ZM9.75 11c0-.576.263-.826.492-.907c.25-.088.714-.06 1.24.444l1.037-1.084c-.825-.79-1.861-1.095-2.773-.775C8.812 9.005 8.25 9.903 8.25 11h1.5Zm3.65 3.274c.46-.338 1.022-.797 1.475-1.321c.434-.502.875-1.183.875-1.953h-1.5c0 .215-.141.546-.51.972c-.348.403-.809.786-1.226 1.092l.887 1.21ZM15.75 11c0-1.097-.563-1.995-1.496-2.322c-.912-.32-1.948-.014-2.773.775l1.038 1.084c.525-.504.989-.532 1.24-.444c.228.08.491.331.491.907h1.5Zm-5.15 3.274c.368.27.782.607 1.4.607v-1.5c-.024 0-.04 0-.094-.029a3.994 3.994 0 0 1-.42-.288l-.887 1.21Zm1.914-1.21a3.994 3.994 0 0 1-.42.288c-.054.029-.07.029-.094.029v1.5c.618 0 1.032-.337 1.4-.607l-.886-1.21Z"/>
                <path stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 18h14"/>
            </g>
        </svg>
      `,
      "Drinks": `
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24">
            <path fill="#ffffff" fill-rule="evenodd" d="M9.147 1.25h5.707c.886 0 1.607 0 2.194.06c.612.061 1.146.192 1.64.495c.155.096.304.203.444.32c.444.373.737.838.99 1.399c.241.538.47 1.222.75 2.062l.012.037l.05.148c.147.443.279.837.347 1.165c.071.347.102.747-.083 1.143c-.093.2-.223.38-.382.53c-.317.301-.707.4-1.058.44c-.18.022-.385.032-.61.037l-1.412 9.649c-.114.776-.209 1.427-.352 1.941c-.15.545-.378 1.028-.814 1.405c-.436.377-.947.532-1.508.602c-.53.067-1.188.067-1.972.067h-2.18c-.784 0-1.442 0-1.972-.067c-.561-.07-1.072-.226-1.508-.602c-.436-.377-.663-.86-.814-1.405c-.143-.514-.238-1.165-.352-1.941l-1.413-9.65a6.346 6.346 0 0 1-.609-.035c-.351-.042-.74-.14-1.058-.44a1.75 1.75 0 0 1-.382-.531c-.185-.396-.154-.796-.083-1.143c.068-.328.2-.722.348-1.165l.013-.04l.048-.145c.28-.84.509-1.524.751-2.062c.252-.561.546-1.026.99-1.398a3.57 3.57 0 0 1 .444-.32c.493-.304 1.027-.435 1.639-.497c.588-.059 1.309-.059 2.195-.059Zm-2.78 7.84l.317 2.16h10.632l.316-2.16H6.368Zm10.73 3.66H6.903l.512 3.5h9.168l.512-3.5Zm-.733 5H7.636l.105.72c.123.836.205 1.392.32 1.805c.109.392.223.56.35.67c.127.11.31.2.715.25c.425.054.987.055 1.831.055h2.086c.844 0 1.407-.001 1.831-.055c.404-.05.588-.14.715-.25c.127-.11.241-.278.35-.67c.115-.413.198-.97.32-1.804l.105-.721ZM7.103 2.802c-.488.049-.775.14-1.004.281a2.251 2.251 0 0 0-.267.193c-.207.173-.384.416-.585.863c-.208.461-.413 1.073-.708 1.959l-.036.107c-.166.496-.267.804-.315 1.034a.748.748 0 0 0-.023.213a.25.25 0 0 0 .046.064a.748.748 0 0 0 .209.044c.233.028.557.03 1.08.03h13c.523 0 .847-.002 1.08-.03a.749.749 0 0 0 .21-.044a.25.25 0 0 0 .045-.064a.749.749 0 0 0-.023-.213c-.048-.23-.15-.538-.315-1.034l-.035-.107c-.296-.886-.501-1.498-.709-1.959c-.2-.447-.378-.69-.585-.863a2.248 2.248 0 0 0-.267-.193c-.23-.14-.516-.232-1.004-.281c-.503-.051-1.148-.052-2.082-.052h-5.63c-.934 0-1.579 0-2.082.052Z" clip-rule="evenodd"/>
        </svg>
      `,
      "Grocery": `
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24">
            <path fill="#ffffff" d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2s-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2s2-.9 2-2s-.9-2-2-2zm-1.45-5c.75 0 1.41-.41 1.75-1.03l3.58-6.49A.996.996 0 0 0 20.01 4H5.21l-.94-2H1v2h2l3.6 7.59l-1.35 2.44C4.52 15.37 5.48 17 7 17h12v-2H7l1.1-2h7.45zM6.16 6h12.15l-2.76 5H8.53L6.16 6z"/>
        </svg>
      `,
      "Public Transport": `
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 14 14">
            <g fill="none" stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round">
                <path d="M11.5.5h-9a1 1 0 0 0-1 1V11a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V1.5a1 1 0 0 0-1-1M3.5 12v1.5m7-1.5v1.5M1.5 7h11"/>
                <path d="M4 9.75a.25.25 0 0 1 0-.5m0 .5a.25.25 0 0 0 0-.5m6 .5a.25.25 0 0 1 0-.5m0 .5a.25.25 0 1 0 0-.5"/>
            </g>
        </svg>
      `,
      "Private Transport": `
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 20 20">
            <g fill="#ffffff" fill-rule="evenodd" clip-rule="evenodd">
                <path d="M4.298 3.954L3.1 8.651a2 2 0 0 0-1.601 1.96V13.5a2 2 0 0 0 2 2h13a2 2 0 0 0 2-2v-2.889a2 2 0 0 0-1.601-1.96l-1.197-4.697a2 2 0 0 0-1.475-1.452A18.211 18.211 0 0 0 10 2c-1.41 0-2.82.168-4.228.502a2 2 0 0 0-1.475 1.452ZM3.5 9.611a.5.5 0 0 0 .485-.376L5.267 4.2a1 1 0 0 1 .738-.726A17.224 17.224 0 0 1 10 3c1.33 0 2.662.158 3.995.475a1 1 0 0 1 .737.726l1.282 5.034a.5.5 0 0 0 .485.376a1 1 0 0 1 1 1V13.5a1 1 0 0 1-1 1h-13a1 1 0 0 1-1-1v-2.889a1 1 0 0 1 1-1Z"/>
                <path d="M5.5 16a1.5 1.5 0 0 0-3 0v1a1.5 1.5 0 0 0 3 0v-1Zm-2 0a.5.5 0 0 1 1 0v1a.5.5 0 0 1-1 0v-1Zm14 0a1.5 1.5 0 0 0-3 0v1a1.5 1.5 0 0 0 3 0v-1Zm-2 0a.5.5 0 0 1 1 0v1a.5.5 0 0 1-1 0v-1Zm-.5-2.5a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3Zm0-2a.5.5 0 1 1 0 1a.5.5 0 0 1 0-1Zm-10 2a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3Zm0-2a.5.5 0 1 1 0 1a.5.5 0 0 1 0-1Zm7.648-7H7.352a1.5 1.5 0 0 0-1.457 1.143l-.49 2A1.5 1.5 0 0 0 6.862 9.5h6.276a1.5 1.5 0 0 0 1.457-1.857l-.49-2A1.5 1.5 0 0 0 12.647 4.5ZM6.866 5.881a.5.5 0 0 1 .486-.381h5.296a.5.5 0 0 1 .485.381l.49 2a.5.5 0 0 1-.485.619H6.862a.5.5 0 0 1-.486-.619l.49-2Z"/>
            </g>
        </svg>
      `,
      "Rental Bike": `
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 512 440">
            <path fill="#ffffff" d="M330.5 85q-17.5 0-30-12.5t-12.5-30t12.5-30t30-12.5t30 12.5t12.5 30t-12.5 30t-30 12.5zm-224 139q44.5 0 75.5 31t31 75.5t-31 75.5t-75.5 31T31 406T0 330.5T31 255t75.5-31zm0 181q30.5 0 52.5-22t22-52.5t-22-52.5t-52.5-22T54 278t-22 52.5T54 383t52.5 22zM230 192l47 49v132h-42V267l-69-60q-12-10-12-30q0-17 12-30l60-60q10-12 30-12q18 0 34 12l41 41q32 32 76 32v43q-64 0-108-45l-17-17zm175.5 32q44.5 0 75.5 31t31 75.5t-31 75.5t-75.5 31t-75.5-31t-31-75.5t31-75.5t75.5-31zm0 181q30.5 0 52.5-22t22-52.5t-22-52.5t-52.5-22t-52.5 22t-22 52.5t22 52.5t52.5 22z"/>
        </svg>
      `,
      "Bills": `
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24">
            <path fill="#ffffff" d="M2 2h20v2h-2v18.08l-1.625-1.3l-1.841-1.472l-1.62 1.44l-.664.59l-.664-.59L12 19.337l-1.586 1.41l-.664.59l-.664-.59l-1.62-1.44l-1.841 1.473L4 22.08V4H2V2Zm4 2v13.92l.875-.7l.659-.528l.63.56l1.586 1.41l1.586-1.41l.664-.59l.664.59l1.586 1.41l1.586-1.41l.63-.56l.659.527l.875.7V4H6Zm2 3h8v2H8V7Zm2 4H9v2h6v-2h-5Z"/>
        </svg>
      `,
      "Shopping": `
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24">
          <path fill="#ffffff" stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m19.26 9.696l1.385 9A2 2 0 0 1 18.67 21H5.33a2 2 0 0 1-1.977-2.304l1.385-9A2 2 0 0 1 6.716 8h10.568a2 2 0 0 1 1.977 1.696ZM14 5a2 2 0 1 0-4 0"/>
        </svg>
      `,
      "Travel": `
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24">
          <path fill="#ffffff" d="m3.65 15.4l1.05-1.05l2.5.35l3.9-3.9l-7.8-4.25l1.4-1.4l9.55 2.45l3.9-3.85q.425-.425 1.05-.425t1.05.425q.425.425.425 1.05t-.425 1.05l-3.85 3.9l2.45 9.55l-1.4 1.4l-4.25-7.8l-3.9 3.9l.35 2.5l-1.05 1.05l-1.75-3.2l-3.2-1.75Z"/>
        </svg>
      `,
      "Others":`
      <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24">
        <path fill="#ffffff" d="M6 7a6 6 0 1 1 11.95.775A6 6 0 0 1 15 19h-2v3h-2v-3H8.5A5.5 5.5 0 0 1 6.191 8.507A6.008 6.008 0 0 1 6 7Zm1.01 3.332A3.502 3.502 0 0 0 8.5 17H15a4 4 0 0 0 1.454-7.728l-.841-.328C15.79 8.304 16 7.672 16 7a4 4 0 1 0-6.4 3.2l-1.2 1.6a6.03 6.03 0 0 1-1.39-1.468Z"/>
      </svg>
      `
    };

    // Helper: format date like "1 Oct"
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { day: 'numeric', month: 'short' });
    }

    // Render expense cards
    function renderExpenses() {
      const expenses = JSON.parse(localStorage.getItem(EXPENSES_KEY)) || [];
      expensesContainer.innerHTML = '';

      // Sort by date descending (latest first)
      expenses.sort((a, b) => new Date(b.date) - new Date(a.date));

      // Take only the first 10
      const latestExpenses = expenses.slice(0, 6);

      latestExpenses.forEach(exp => {
        const card = document.createElement('div');
        const icon = categoryIcons[exp.category]
        card.className = 'flex justify-between items-center bg-[#E0DDCF] rounded-xl p-4 text-black shadow-lg';

        card.innerHTML = `
          <article class="flex items-center gap-4">
            <article class="bg-[#212124] p-2 rounded-lg">
              ${icon}
            </article>
            <div class="flex flex-col">
              <span class="text-xs">${formatDate(exp.date)}</span>
              <span class="text-xl font-semibold">${exp.name}</span>
            </div>
          </article>
          <span class="text-2xl">$${exp.amount.toFixed(2)}</span>
        `;
        expensesContainer.appendChild(card);
      });
    }

    // Load data from JSON if localStorage is empty
    if (!localStorage.getItem(STORAGE_KEY)) {
      fetch('./assets/data/recurring-payments.json')
        .then(res => {
          if (!res.ok) throw new Error('Failed to fetch JSON');
          return res.json();
        })
        .then(data => {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
          renderCards(); // Render after storing
        })
        .catch(err => console.error(err));
    } else {
      renderCards(); // Already in localStorage, render immediately
    }

    // Load data if not in localStorage
    if (!localStorage.getItem(EXPENSES_KEY)) {
      fetch('./assets/data/expenses.json')
        .then(res => {
          if (!res.ok) throw new Error('Failed to fetch expenses.json');
          return res.json();
        })
        .then(data => {
          localStorage.setItem(EXPENSES_KEY, JSON.stringify(data));
          renderExpenses();
        })
        .catch(err => console.error(err));
    } else {
      renderExpenses();
    }
  </script>
</body>
</html>